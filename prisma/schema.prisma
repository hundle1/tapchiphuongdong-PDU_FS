generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["relationJoins"]
}

datasource db {
  provider = "sqlserver"
  url      = env("DATABASE_URL")
}

model TaiKhoanNguoiDung {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String?
  role      String   @default("USER")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  magazines Magazine[]

  @@map("users")
}

model Magazine {
  id                  String             @id @default(cuid())
  tieuDe              String
  moTa                String?
  anhBia              String?
  fileUpload          File?              @relation(fields: [fileUploadId], references: [id])
  fileUploadId        String?
  soTrang             Int? // số trang PDF/Word
  trangThai           String             @default("draft")
  createdAt           DateTime           @default(now())
  updatedAt           DateTime           @updatedAt
  TaiKhoanNguoiDung   TaiKhoanNguoiDung? @relation(fields: [taiKhoanNguoiDungId], references: [id])
  taiKhoanNguoiDungId String?
  Page                Page[]
}

model Page {
  id        String   @id @default(cuid())
  soTrang   Int
  imageUrl  String? // ảnh convert từ pdf/word
  noiDung   String? // text OCR / trích xuất
  magazine  Magazine @relation(fields: [tapChiId], references: [id])
  createdAt DateTime @default(now())
  tapChiId  String
}

model File {
  id        String     @id @default(cuid())
  fileName  String
  fileType  String
  fileUrl   String // link Supabase S3 hoặc local storage
  createdAt DateTime   @default(now())
  Magazine  Magazine[]
}
